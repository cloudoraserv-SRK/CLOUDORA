<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Daily Score - Cloudora</title>

<link rel="stylesheet" href="../style.css">

<style>
.score-card {
  background: #fff;
  max-width: 650px;
  margin: 40px auto;
  padding: 25px;
  border-radius: 18px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}
.score-title {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 10px;
}
.metric-box {
  background: #F3F4F6;
  padding: 15px;
  border-radius: 12px;
  margin-top: 12px;
  display: flex;
  justify-content: space-between;
}
.metric-label {
  font-weight: 600;
}
.back-btn {
  margin-top: 20px;
  padding: 12px;
  width: 100%;
  border: none;
  background: #4F46E5;
  color: white;
  border-radius: 10px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<header class="site-header">
  <div class="brand">Daily Score</div>
  <button onclick="goBack()" class="btn-mini">← Back</button>
</header>

<main class="container fade-in">

  <div class="score-card">

    <div class="score-title">Today's Performance Score</div>

    <div id="scoreOutput">
      Loading score...
    </div>

    <button class="back-btn" onclick="goBack()">Back to Dashboard</button>

  </div>

</main>

<!-- ✅ MUST BE FIRST -->
<script src="../api/supabase.min.js"></script>

<!-- ✅ MUST BE AFTER supabase.min.js -->
<script src="../global.js"></script>

<script>
const empID = localStorage.getItem("employee_id");
if (!empID) window.location.href = "./login.html";

function goBack() {
  window.location.href = "./dashboard.html";
}

// -------------------------------------------
//  FETCH DAILY SCORE FROM BACKEND
// -------------------------------------------
async function loadScore() {
  const res = await fetch(CONFIG.BACKEND + "/api/job/daily-score", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ employee_id: empID })
  });

  const j = await res.json();

  // If no score yet
  if (!j.ok || !j.score) {
    document.getElementById("scoreOutput").innerHTML = `
      <p>No score recorded yet.</p>
      <p>Start making calls to generate your daily score!</p>
    `;
    return;
  }

  const score = j.score;

  document.getElementById("scoreOutput").innerHTML = `
    <div class="metric-box">
      <div class="metric-label">Total Calls</div>
      <div>${score.total_calls}</div>
    </div>

    <div class="metric-box">
      <div class="metric-label">Interested Leads</div>
      <div>${score.interested}</div>
    </div>

    <div class="metric-box">
      <div class="metric-label">Callbacks</div>
      <div>${score.callback}</div>
    </div>

    <div class="metric-box">
      <div class="metric-label">Not Interested</div>
      <div>${score.not_interested}</div>
    </div>

    <div class="metric-box">
      <div class="metric-label">Wrong Numbers</div>
      <div>${score.wrong_number}</div>
    </div>

    <div class="metric-box" style="background:#E0E7FF;">
      <div class="metric-label">Final Score</div>
      <div><b>${score.final_score}</b></div>
    </div>
  `;
}

loadScore();
</script>

</body>
</html>
